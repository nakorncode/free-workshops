# Logic Error ทดสอบความผิดพลาดจากโค้ดที่มีกระบวนการไม่ถูกต้อง

ในส่วนของ [Logic Error](https://en.wikipedia.org/wiki/Logic_error) จะเป็นปัญหาที่โค้ดสามารถรันและทำงานได้ เพียงแต่ผลลัพธ์อาจจะไม่ถูกต้อง โดยปกติสำหรับงานของโปรแกรมเมอร์อย่างเราถือเป็นเรื่องที่ยากมากๆ สำหรับการตรวจสอบว่าโค้ดส่วนใดที่ทำให้ได้ผลลัพธ์ไม่ถูกต้อง เพราะมันจะไม่มีการแจ้ง Error ใดๆ สิ่งที่ผิดพลาดคือได้ข้อมูลไม่ถูกต้องซึ่งต้องไล่หาสาเหตุทีละบรรทัด

จากตัวอย่างเราก็ได้ใช้ [Claude AI](https://claude.ai/) สร้างเช่นเคย โดยโค้ดที่ได้จะเป็นการจำลองระบบธนาคาร ที่มีการเปิดบัญชี ฝาก-ถอนเงินต่างๆ ดังนั้นเราจะมาดูเป็นข้อๆกันว่าโค้ดที่ถูกสร้างขึ้นมา มีปัญหาอะไรบ้าง

1. สามารถฝาก-ถอนเงินเลขติดลบได้ เป็นเรื่องอันตราย เพราะหากบัญชีเรามีเงินจำนวน 5,000 บาท หากระบบสามารถฝากเงินเพิ่ม แต่เป็น `-500` ผลลัพธ์ที่ได้แค่เงินเราจะเหลือ 4,500 บาทซะงั้นทั้งๆที่ฝากเพิ่ม เพราะว่า `5000 - (-500) = 4500`  จึงควรป้องกันไม่ให้มีการฝากเงินเข้าหรือถอนเงินออกเป็นเลขติดลบได้
2. ขาดการตรวจสอบจำนวนเงินภายในบัญชีก่อนถอนหรือโอนเงิน เป็นเรื่องอันตรายเช่นกัน เพราะหากจำนวนเงินคงเหลือบัญชีไม่พอแล้ว ก็ไม่ควรจะถอนเงินออกได้ แต่โค้ดนี้ขาดการตรวจสอบเรื่องเหล่านี้ ทำให้แม้ว่าเงินบัญชีเราจะมี 5,000 บาท แต่เราสามารถสั่งถอน 5,000,000 บาทได้เช่นกัน
3. การส่งข้อมูลประเภท Mutable Reference เรื่องนี้จะเป็นปัญหาเชิงเทคนิค ถ้าเล่าให้เข้าใจง่ายๆเช่น ข้อมูล A เรียกใช้คัดลอกข้อมูลไปยัง B แต่เมื่อ B แก้ข้อมูล A กลับมีข้อมูลเปลี่ยนแปลงตามกันไปด้วย ซึ่งไม่ควรเกิดขึ้น เพราะมีโอกาสที่จะไปดัดแปลงข้อมูลบัญชีธนาคารมั่วทั้งระบบ จึงต้องส่งข้อมูลในรูปแบบ [Immutable](https://en.wikipedia.org/wiki/Immutable_object) แทน
4. ขาดการตรวจสอบเลขบัญชีที่ซ้ำกัน กล่าวคือโค้ดตัวอย่างมีการสร้างบัญชี `ACC001` ไปแล้วครั้งหนึ่ง แต่ก็ยังมีการพยายามสร้างใหม่อีกครั้ง ตามหลักการแล้วไม่ควรสร้างใหม่ได้
5. โค้ดสามารถแก้ไขวันเวลาของการโอนเงินได้ ซึ่งไม่ควรเกิดขึ้น ตัวอย่างเราโอนเงินเมื่อปี 2024 แต่โค้ดกลับสามารถแก้ไขเงินโอนเหล่านั้นให้เกิดขึ้นในปี 2000 ได้
6. การแสดงผลของจำนวนเงินในบัญชีลูกค้าไม่ถูกต้อง เนื่องจากมีโค้ดที่แทรกไว้ว่า หากลูกค้าไม่มีบัญชีใดๆ จะแสดงผลเป็นจำนวนเงิน 1,000 บาท ซึ่งจริงๆต้องเป็นเลข 0 หรือก็คือไม่มีจำนวนเงินคงเหลือ

เชื่อหรือไม่ว่า ChatGPT-4o-mini ที่เป็นตัวฟรีและมีประสิทธิภาพต่ำกว่า ก็ยังสามารถวิเคราะห์และตรวจสอบโค้ดทั้งหมดได้ครบถ้วน ทั้งๆที่เป็นโจทย์ที่ยากขึ้นมาในระดับหนึ่ง และยังสามารถช่วยเหลือตรวจสอบโค้ดในจุดที่ผมเองก็มองข้ามไปได้เช่นกัน นับว่าช่วยเหลือการตรวจสอบโค้ดของเราได้ดีมาก

**ลิงก์สำหรับแชทของ AI:** [https://chatgpt.com/share/64126f0a-9439-4620-9726-38649a22e27a](https://chatgpt.com/share/64126f0a-9439-4620-9726-38649a22e27a)

## วิธีการรันไฟล์

กรณีนี้เราต้องการรันไฟล์ TypeScript ทำได้หลายวิธี แต่ผมจะเลือกใช้วิธีนี้เพราะง่ายและสะดวกสำหรับผม

- ติดตั้ง [Node.js](https://nodejs.org/en)
- ใช้คำสั่ง `npm install tsx -g`
- จากนั้น `tsx *.ts` ตามไฟล์ที่เราต้องการ โดยจะมี `incorrect.ts` คือไฟล์ที่ผิดพลาด ส่วนของ `correct.ts` คือไฟล์ที่ได้รับการแก้ไขผ่าน AI แล้ว
